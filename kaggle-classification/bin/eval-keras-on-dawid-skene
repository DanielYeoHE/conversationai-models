#!/bin/bash

# Evaluate the dawid-skene model on mean test data sets
#
#
#

DATE=`date '+%Y%m%d_%H%M%S'`
OUTPUT_PATH=runs/${DATE}
TEST_PATH=gs://annotator_models/data_splits/
LOG_PATH=${OUTPUT_PATH}/logs/

declare -a TEST_FILES=("test_mean_q42017" "test_hat_q42017")

JOB_DIR_MEAN=gs://kaggle-model-experiments/keras_runs/ericagreene/20180514_193411/17
JOB_DIR_HAT=gs://kaggle-model-experiments/keras_runs/ericagreene/20180514_193411/3

for test_file in "${TEST_FILES[@]}"
do

    # score test data with model trained on dawid-skene data
    python -m keras_trainer.model \
	--test_path=${TEST_PATH}${test_file}.csv \
	--embeddings_path=local_data/glove.6B/glove.6B.100d.txt \
	--job-dir=${JOB_DIR_HAT} \
	--log_path=${LOG_PATH} \
	--labels=threat,flirtation,identity_hate,insult,obscene,sexual_explicit,frac_very_neg,frac_neg \
	--run-training=false \
	--write-scored-test-data=true \
	--scored-test-data-filename=${test_file}_scored.csv

    # score test data with model trained on mean labels data
    python -m keras_trainer.model \
	--test_path=${TEST_PATH}${test_file}.csv \
	--embeddings_path=local_data/glove.6B/glove.6B.100d.txt \
	--job-dir=${JOB_DIR_MEAN} \
	--log_path=${LOG_PATH} \
	--labels=threat,flirtation,identity_hate,insult,obscene,sexual_explicit,frac_very_neg,frac_neg \
	--run-training=false \
	--write-scored-test-data=true \
	--scored-test-data-filename=${test_file}_scored.csv

done
